/*!
 * http://www.zkea.net/
 * Copyright 2016 ZKEASOFT
 * http://www.zkea.net/licenses
 */
var Easy=Easy||{};Easy.UI={DropDownList:function(){$("select.easy").not("[multiple]").each(function(){function o(){var e,o,r;if(n.hasClass("Open"))return $(".DropDownList_Options").remove(),n.removeClass("Open"),$(document).unbind("click",u),!1;n.addClass("Open");e=[];e.push("<ul class='DropDownList_Options'>");o=t.find("option");o.each(function(){var n=$(this).attr("value"),t,i;n&&(t=$(this).text(),i="<li val='"+n+"'>"+t+"<\/li>",e.push(i))});e.push("<\/ul>");r=$(e.join(""));r.find("li").click(function(){f=$(this).attr("val");i=$(this).text();t.val($(this).attr("val"));t.change()});r.width($(this).width()+19);r.css("left",$(this).offset().left);r.css("top",$(this).offset().top+n.height());o.length>15&&r.height(250);setTimeout(function(){$(document).bind("click",u);$("body").append(r)},10)}function u(){$(".DropDownList_Options").remove();n.removeClass("Open");$(document).unbind("click",u)}var r,n;if(!$(this).attr("easy")){$(this).attr("easy","easy");var t=$(this),f=t.val(),e=!1,i=t.find("option").first().text();t.find("option:selected").length&&(i=$(this).find("option:selected").text());i==""&&(i="&nbsp;");f==""&&(e=!0);r=[];r.push("<div class='DropDownList'>");r.push("<div class='TextPlace'><span>"+i+"<\/span><\/div><div class='DropIcon'>&nbsp;<\/div>");r.push("<div style='clear:both'><\/div>");r.push("<\/div>");n=$(r.join(""));n.insertAfter(t);n.css("width",$(this).outerWidth());t.change(function(){i=$(this).find("option:selected").text();n.removeClass("Open");e?(n.find(".TextPlace").html("<span>"+i+"<\/span><div class='Clear'><\/div>"),n.find(".TextPlace").css("position","relative"),i==""?n.find(".Clear").remove():n.find(".Clear").click(function(){return t.val(""),t.change(),n.find(".TextPlace").html("<span>&nbsp;<\/span>"),!1})):n.find(".TextPlace").html("<span>"+i+"<\/span>")});t.hide();t.attr("readonly")||t.attr("disabled")?n.addClass("readonly"):n.click(o)}})},MultiSelect:function(){$("select.easy[multiple]").each(function(){function f(){var r,f,n;if(t.hasClass("Open"))return $(document).unbind("click",u),$(".DropDownList_Options").remove(),t.removeClass("Open"),!0;t.addClass("Open");r=[];r.push("<ul class='DropDownList_Options'>");f=i.find("option");f.each(function(){var n=$(this).attr("value"),i,u,t;n&&(i=$(this).text(),u=$(this).prop("selected"),u?(t="<li val='"+n+"' id='selectBoxli'><input id='selectBox'  type='checkbox' checked='checked' val='"+n+"' />"+i+"<\/li>",r.push(t)):(t="<li val='"+n+"' id='selectBoxli'><input id='selectBox' type='checkbox' val='"+n+"' />"+i+"<\/li>",r.push(t)))});r.push("<\/ul>");n=$(r.join(""));n.find("input[type='checkbox']").click(function(){var n=i.find("option[value='"+$(this).attr("val")+"']");n.attr("selected")?n.removeAttr("selected"):n.attr("selected","selected");i.change()});n.width($(this).width()+19);n.css("left",$(this).offset().left);n.css("top",$(this).offset().top+t.height());f.length>15&&n.height(250);setTimeout(function(){$(document).bind("click",u);$("body").append(n);Easy.UI.CheckBox()},10)}function u(n){if(n.target.id=="selectBox"||n.target.id=="selectBoxli")return n.target.id=="selectBoxli"&&($(n.target).find("#selectBox").click(),$(n.target).find("#selectBox").change()),!0;$(".DropDownList_Options").remove();t.removeClass("Open");$(document).unbind("click",u)}var i,n,r,t;$(this).attr("easy")||($(this).attr("easy","easy"),i=$(this),n="",i.find("option:selected").length&&$(this).find("option:selected").each(function(){n==""?n=$(this).text():n+=","+$(this).text()}),n==""&&(n="&nbsp;"),r=[],r.push("<div class='DropDownList'>"),r.push("<div class='TextPlace' title="+n+"><span>"+n+"<\/span><\/div><div class='DropIcon'>&nbsp;<\/div>"),r.push("<div style='clear:both'><\/div>"),r.push("<\/div>"),t=$(r.join("")),t.insertAfter(i),t.css("width",$(this).outerWidth()),i.change(function(){if(n="",i.find("option[selected='selected']").each(function(){n+=n==""?$(this).text():","+$(this).text()}),n!=""){var r=t.find(".TextPlace");r.attr("title",n);r.html("<span>"+n+"<\/span><div class='Clear'><\/div>")}else t.find(".TextPlace").html("<span>&nbsp;<\/span>");t.find(".TextPlace").css("position","relative");t.find(".Clear").click(function(){return i.find("option").each(function(){$(this).removeAttr("selected")}),$(".DropDownList_Options").remove(),$(document).unbind("click",u),i.change(),t.removeClass("Open"),!1})}),i.hide(),i.attr("readonly")||i.attr("disabled")||t.click(f))})},CheckBox:function(){$("input.easy[type='checkbox']").each(function(){function i(){n.prop("checked")?(t.addClass("CheckBoxOpen"),n.val("true")):(t.removeClass("CheckBoxOpen"),n.val("false"))}if(!$(this).attr("easy")){$(this).attr("easy","easy");var n=$(this),r=n.prop("checked"),t=$("<div class='CheckBox'><\/div>");r&&t.addClass("CheckBoxOpen");t.insertAfter(n);n.change(i);n.attr("readonly")||n.attr("disabled")?t.addClass("readonly"):(n.click(i),t.click(function(){$(this).hasClass("CheckBoxOpen")?n.removeAttr("checked"):n.attr("checked","checked");n.change()}));n.hide()}})},DateInput:function(n){n||(n="input.easy[ValueType='Date']");$(n).each(function(){var n=$(this),t;n.attr("easy")||(t=n.attr("DateFormat"),n.parent().css("position","relative"),$(this).datetimepicker({locale:"zh_cn",format:"YYYY/MM/DD H:mm:ss"}))})},NumberInput:function(){$("input.easy[ValueType='Num']").each(function(){$(this).attr("easy")||($(this).attr("easy","easy"),$(this).keydown(function(n){var t=parseInt($(this).attr("FloatScale")),i,r;if(t||(t=0),n.keyCode>=48&&n.keyCode<=57||n.keyCode>=8&&n.keyCode<=9||n.keyCode==190||n.keyCode==189||n.keyCode>=96&&n.keyCode<=105){if(n.keyCode==8||n.keyCode==9)return!0;if(n.keyCode==189)return i=parseFloat($(this).attr("Min")),r=!0,!isNaN(i)&&i>0&&(r=!1),$(this).val().indexOf("-")==-1&&r?$(this).val("-"+$(this).val()):$(this).val($(this).val().replace("-","")),!1;if(n.keyCode==190)return($(this).val().indexOf(".")==-1&&$(this).val().length==0&&t!=0&&$(this).val("0."),$(this).val().indexOf(".")>=0||t==0)?!1:!0}else return!1}),$(this).blur(function(){var r,i,n,t;if(isNaN(parseFloat($(this).val()))){$(this).val("");return}r=parseInt($(this).attr("FloatScale"));$(this).val().indexOf(".")>=0?$(this).val().split(".")[1].length>=r?$(this).val($(this).val().split(".")[0]+"."+$(this).val().split(".")[1].substring(0,2)):(i=parseInt($(this).val().split(".")[1]),i||(i="00"),$(this).val($(this).val().split(".")[0]+"."+i)):$(this).val().length>0&&(n=$(this).attr("Min"),(n||n==0)&&parseFloat($(this).val())<n&&$(this).val(n),t=$(this).attr("Max"),(t||t==0)&&parseFloat($(this).val())>t&&$(this).val(t))}))})},AutoComeleteInput:function(){$(this).attr("easy")||($(this).attr("easy","easy"),$("input[AutoComplete='true']").each(function(){var dataSource=$(this).attr("DataSource"),valueField=$(this).attr("ValueField"),funAddParameter=$(this).attr("FunAddParameter"),addOthPa=!1,oldKey="";try{funAddParameter=eval(funAddParameter)}catch(ex){}funAddParameter instanceof Function&&(addOthPa=!0);dataSource&&($(this).keydown(function(n){if(n.keyCode==38||n.keyCode==40)return!1}),$(this).keyup(function(n){var t,f,u,o,s,i,r,e;if(n.keyCode==38)return t=$(".autocompleteResult .active"),t.length==0||t.index()==0?$(".autocompleteResult>li").last().addClass("active"):t.index()!=0&&t.prev("li").addClass("active"),t.removeClass("active"),!1;if(n.keyCode==40)return t=$(".autocompleteResult .active"),f=$(".autocompleteResult>li").length-1,t.length==0||t.index()==f?$(".autocompleteResult>li").first().addClass("active"):t.index()!=f&&t.next("li").addClass("active"),t.removeClass("active"),!1;if(n.keyCode==13)return u=$(".autocompleteResult .active"),u.length==1&&(o=u.attr("val"),s=u.attr("text"),$(this).val(s),$("#"+valueField).val(o),$(".autocompleteResult").remove()),!1;if(i=$(this),r=$(this).val(),r==oldKey||r=="")return r==""&&(oldKey=r,$(".autocompleteResult").remove()),!1;$(".autocompleteResult").remove();oldKey=r;e={key:r};addOthPa&&$.extend(e,funAddParameter.call());$.post(dataSource,e,function(n){var t=[],u,f;t.push("<ul class='autocompleteResult'>");for(u in n)n[u]instanceof Function||(f=n[u].Text.replace(r,"<strong style='color:red'>"+r+"<\/strong>"),t.push("<li val='"+n[u].Value+"' text='"+n[u].Text+"'>"+f+"<\/li>"));t.push("<\/ul>");t=$(t.join(""));t.children("li").hover(function(){$(this).addClass("active")},function(){$(this).removeClass("active")});$("body").append(t);t.width(i.width()+parseInt(i.css("padding-left"))+parseInt(i.css("padding-right")));t.css("top",i.offset().top+i.height()+parseInt(i.css("padding-top"))+parseInt(i.css("padding-bottom"))+1);t.css("left",i.offset().left)},"json")}),$(this).blur(function(){var n,i,r;if(oldKey="",n=$(".autocompleteResult .active"),n.length==1&&(i=n.attr("val"),r=n.attr("text"),$(this).val(r),$("#"+valueField).val(i)),valueField){var f=$(this),t=$(this).val(),u={key:t};addOthPa&&$.extend(u,funAddParameter.call());t&&$.post(dataSource,u,function(n){var i=!0;for(var r in n)n[r]instanceof Function||n[r].Text==t&&(i=!1);i&&(f.val(""),$("#"+valueField).val(""))},"json")}$(".autocompleteResult").remove()}))}))},Init:function(){this.DropDownList();this.MultiSelect();this.CheckBox();this.DateInput();this.NumberInput();this.AutoComeleteInput()}};$(function(){Easy.UI.Init()});